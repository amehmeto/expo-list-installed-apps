# Skip pre-push hooks in CI (checks already run in CI workflow before semantic-release)
if [ "$CI" = "true" ]; then
  exit 0
fi

# Block direct push to main/master
sh .husky/scripts/no-direct-push-main-master.sh

# Check for conflicts with master before pushing
sh .husky/scripts/check-conflicts-with-master.sh

# Run TypeScript unit tests
npm test

# Run Kotlin unit tests and detekt
if [ -d "example/android" ] && [ -f "example/android/gradlew" ]; then
  # Extract module name from package.json (format: @scope/name -> scope-name or just name)
  MODULE_NAME=$(node -p "require('./package.json').name.replace('@', '').replace('/', '-')")

  echo "Running detekt..."
  cd example/android && ./gradlew ":${MODULE_NAME}:detekt" || exit 1

  echo "Running Kotlin unit tests..."
  ./gradlew ":${MODULE_NAME}:testDebugUnitTest" || exit 1
  cd ../..
else
  echo "Android project not found, skipping Kotlin checks"
fi
